---
title: Perfis de certificado definidos pelo usuário para lojas de varejo
description: Este tópico fornece uma visão geral sobre como os certificados são usados em lojas de varejo.
author: josaw
manager: annbe
ms.date: 10/09/2020
ms.topic: article
ms.prod: ''
ms.service: dynamics-365-retail
ms.technology: ''
ms.search.form: RetailFormLayout, RetailParameters
audience: Application User
ms.reviewer: josaw
ms.search.scope: Core, Operations, Retail
ms.search.region: Global
ms.search.industry: Retail
ms.author: v-kikozl
ms.search.validFrom: 2020-10-09
ms.dyn365.ops.version: 10.0.15
ms.openlocfilehash: 75edc1b683c4ea6c2bac8e509e6f6da8c56c5e6a
ms.sourcegitcommit: 9c05d48f6e03532aa711e1d89d0b2981e9d37200
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 12/03/2020
ms.locfileid: "4665238"
---
# <a name="user-defined-certificate-profiles-for-retail-stores"></a><span data-ttu-id="aae34-103">Perfis de certificado definidos pelo usuário para lojas de varejo</span><span class="sxs-lookup"><span data-stu-id="aae34-103">User-defined certificate profiles for retail stores</span></span>

[!include [banner](../includes/banner.md)]


## <a name="overview"></a><span data-ttu-id="aae34-104">Visão Geral</span><span class="sxs-lookup"><span data-stu-id="aae34-104">Overview</span></span>

<span data-ttu-id="aae34-105">Este tópico fornece uma visão geral dos perfis de certificado disponíveis no Microsoft Dynamics 365 Commerce.</span><span class="sxs-lookup"><span data-stu-id="aae34-105">This topic provides an overview of the certificate profiles that are available in Microsoft Dynamics 365 Commerce.</span></span> <span data-ttu-id="aae34-106">Essa funcionalidade estende o recurso [Gerenciar segredos para canais de varejo](../dev-itpro/manage-secrets.md) adicionando suporte a certificados locais.</span><span class="sxs-lookup"><span data-stu-id="aae34-106">This functionality extends the [Manage secrets for retail channels](../dev-itpro/manage-secrets.md) feature by adding support for local certificates.</span></span>

<span data-ttu-id="aae34-107">Enquanto o ponto de venda (PDV) estiver sendo executado no modo offline, ele não poderá acessar os certificados armazenados no cofre de chaves.</span><span class="sxs-lookup"><span data-stu-id="aae34-107">While the point of sale (POS) is running in offline mode, it can't access the certificates that are stored in the key vault.</span></span> <span data-ttu-id="aae34-108">Em vez disso, o certificado local deve ser usado.</span><span class="sxs-lookup"><span data-stu-id="aae34-108">The local certificate should be used instead.</span></span> <span data-ttu-id="aae34-109">Os seguintes recursos têm suporte:</span><span class="sxs-lookup"><span data-stu-id="aae34-109">The following capabilities are supported:</span></span>

- <span data-ttu-id="aae34-110">Como usar certificados locais em cenários de fallback do cofre de chaves</span><span class="sxs-lookup"><span data-stu-id="aae34-110">Using local certificates in key vault fallback scenarios</span></span>
- <span data-ttu-id="aae34-111">Como usar certificados locais sem um cofre de chaves (por exemplo, em uma instalação local)</span><span class="sxs-lookup"><span data-stu-id="aae34-111">Using local certificates without a key vault (for example in an on-premises installation)</span></span>
- <span data-ttu-id="aae34-112">Atualização gradual de certificados, em que algumas lojas e terminais usam uma nova versão do certificado, mas outras lojas e terminais continuam a usar a versão anterior</span><span class="sxs-lookup"><span data-stu-id="aae34-112">Gradual update of certificates, where some stores and terminals use a new version of the certificate, but other stores and terminals continue to use the previous version</span></span>

<span data-ttu-id="aae34-113">A funcionalidade de perfis de certificado permite especificar um certificado padrão e definir a ordem em que os certificados no mesmo perfil de certificado são pesquisados.</span><span class="sxs-lookup"><span data-stu-id="aae34-113">The certificate profiles functionality lets you specify a default certificate and set the order that certificates in the same certificate profile are searched in.</span></span> <span data-ttu-id="aae34-114">Essa funcionalidade também fornece uma abordagem de configuração semelhante para certificados locais e certificados do Key Vault.</span><span class="sxs-lookup"><span data-stu-id="aae34-114">This functionality also provides a similar setup approach for local certificates and Key Vault certificates.</span></span> <span data-ttu-id="aae34-115">Você pode adicionar configurações específicas da empresa para certificados, mas o identificador exclusivo entre empresas para cada certificado pode ser usado nos canais do Commerce.</span><span class="sxs-lookup"><span data-stu-id="aae34-115">You can add company-specific settings for certificates, but the unique cross-company identifier for each certificate can be used in the Commerce channels.</span></span>

### <a name="scenarios"></a><span data-ttu-id="aae34-116">Cenários</span><span class="sxs-lookup"><span data-stu-id="aae34-116">Scenarios</span></span>

<span data-ttu-id="aae34-117">A funcionalidade de perfis de certificado oferece suporte aos seguintes cenários nos canais do Commerce:</span><span class="sxs-lookup"><span data-stu-id="aae34-117">The certificate profiles functionality supports the following scenarios in the Commerce channels:</span></span>

- <span data-ttu-id="aae34-118">Use um certificado local em cenários de fallback do cofre de chaves.</span><span class="sxs-lookup"><span data-stu-id="aae34-118">Use a local certificate in key vault fallback scenarios.</span></span> <span data-ttu-id="aae34-119">Veja aqui alguns exemplos desses cenários de fallback:</span><span class="sxs-lookup"><span data-stu-id="aae34-119">Here are some examples of these fallback scenarios:</span></span>

    - <span data-ttu-id="aae34-120">O armazenamento do cofre de chaves não está acessível.</span><span class="sxs-lookup"><span data-stu-id="aae34-120">The key vault storage isn't accessible.</span></span>
    - <span data-ttu-id="aae34-121">Um certificado não foi encontrado no armazenamento do cofre de chaves.</span><span class="sxs-lookup"><span data-stu-id="aae34-121">A certificate isn't found in the key vault storage.</span></span>
    - <span data-ttu-id="aae34-122">O PDV está sendo executado no modo offline.</span><span class="sxs-lookup"><span data-stu-id="aae34-122">The POS is running in offline mode.</span></span>

- <span data-ttu-id="aae34-123">Use certificados locais, mas sem armazená-los no cofre de chaves (por exemplo, em uma instalação na infraestrutura local).</span><span class="sxs-lookup"><span data-stu-id="aae34-123">Use local certificates, but without storing them in the key vault (for example, in an on-premises installation).</span></span>
- <span data-ttu-id="aae34-124">Faça uma atualização gradual de certificados, em que uma nova versão do certificado é usada somente em lojas ou em terminais em que a nova versão já está disponível.</span><span class="sxs-lookup"><span data-stu-id="aae34-124">Do a gradual update of certificates, where a new version of the certificate is used only in stores or on terminals where the new version is already available.</span></span>
- <span data-ttu-id="aae34-125">Use o mesmo certificado em várias empresas.</span><span class="sxs-lookup"><span data-stu-id="aae34-125">Use the same certificate in several companies.</span></span>

## <a name="set-up-certificate-profiles"></a><span data-ttu-id="aae34-126">Configurar perfis de certificado</span><span class="sxs-lookup"><span data-stu-id="aae34-126">Set up certificate profiles</span></span>

<span data-ttu-id="aae34-127">O procedimento a seguir explica como configurar perfis de certificado.</span><span class="sxs-lookup"><span data-stu-id="aae34-127">The following procedure explains how to set up certificate profiles.</span></span> <span data-ttu-id="aae34-128">Antes de usar perfis de certificado nos canais do Commerce, siga estas etapas para definir as configurações.</span><span class="sxs-lookup"><span data-stu-id="aae34-128">Before you use certificate profiles in the Commerce channels, follow these steps to configure the settings.</span></span>

1. <span data-ttu-id="aae34-129">No espaço de trabalho **Gerenciamento de recursos** , ative o recurso **Perfis de certificado definidos pelo usuário para lojas de varejo**.</span><span class="sxs-lookup"><span data-stu-id="aae34-129">In the **Feature management** workspace, turn on the **User-defined certificate profiles for retail stores** feature.</span></span>
2. <span data-ttu-id="aae34-130">Vá para **Administração do sistema \> Configurar \> Perfis de certificado**.</span><span class="sxs-lookup"><span data-stu-id="aae34-130">Go to **System administration \> Setup \> Certificate profiles**.</span></span>
3. <span data-ttu-id="aae34-131">Crie um registro e defina os campos **Perfil de certificado**, **Nome** e **Descrição** para ele.</span><span class="sxs-lookup"><span data-stu-id="aae34-131">Create a record, and set the **Certificate profile**, **Name**, and **Description** fields for it.</span></span>

    > [!NOTE]
    > <span data-ttu-id="aae34-132">O perfil de certificado é um identificador exclusivo de um certificado em todas as empresas e componentes do Commerce.</span><span class="sxs-lookup"><span data-stu-id="aae34-132">The certificate profile is a unique identifier of a certificate across all companies and Commerce components.</span></span>

3. <span data-ttu-id="aae34-133">Na guia **Entidades legais**, adicione uma linha e selecione a entidade legal (empresa) para a qual o perfil de certificado atual deve ser usado.</span><span class="sxs-lookup"><span data-stu-id="aae34-133">On the **Legal entities** tab, add a line, and select the legal entity (company) that the current certificate profile should be used for.</span></span> <span data-ttu-id="aae34-134">Se o perfil de certificado tiver de ser usado para várias entidades legais, repita essa etapa para adicionar uma linha para cada entidade legal adicional.</span><span class="sxs-lookup"><span data-stu-id="aae34-134">If the certificate profile should be used for multiple legal entities, repeat this step to add a line for each additional legal entity.</span></span>
4. <span data-ttu-id="aae34-135">Selecione **Configurações** para abrir a página **Configurações do perfil de certificado**, na qual você pode inserir configurações específicas da empresa para o perfil de certificado.</span><span class="sxs-lookup"><span data-stu-id="aae34-135">Select **Settings** to open the **Certificate profile settings** page, where you can enter company-specific settings for the certificate profile.</span></span>

### <a name="certificate-profile-settings"></a><span data-ttu-id="aae34-136">Configurações de perfil de certificado</span><span class="sxs-lookup"><span data-stu-id="aae34-136">Certificate profile settings</span></span>

<span data-ttu-id="aae34-137">Quando você seleciona **Configurações** para linhas de perfil de certificado, a página **Configurações de perfil de certificado** é exibida.</span><span class="sxs-lookup"><span data-stu-id="aae34-137">When you select **Settings** for certificate profile lines, the **Certificate profile settings** page appears.</span></span> <span data-ttu-id="aae34-138">Esta página permite que você especifique quais certificados podem ser usados quando o perfil atual do certificado é chamado nos canais do Commerce.</span><span class="sxs-lookup"><span data-stu-id="aae34-138">This page lets you specify which certificates can be used when the current certificate profile is called in the Commerce channels.</span></span> <span data-ttu-id="aae34-139">Você também pode especificar a ordem em que os certificados devem ser pesquisados.</span><span class="sxs-lookup"><span data-stu-id="aae34-139">You can also specify the order that certificates should be searched in.</span></span>

> [!NOTE]
> <span data-ttu-id="aae34-140">O campo **Prioridade** é definido automaticamente.</span><span class="sxs-lookup"><span data-stu-id="aae34-140">The **Priority** field is automatically set.</span></span> <span data-ttu-id="aae34-141">O valor **1** representa a prioridade mais alta.</span><span class="sxs-lookup"><span data-stu-id="aae34-141">A value of **1** represents the highest priority.</span></span> <span data-ttu-id="aae34-142">Quando uma nova linha é adicionada na página **Configurações do perfil de certificado**, sua prioridade é definida como um número maior do que a prioridade da linha anterior.</span><span class="sxs-lookup"><span data-stu-id="aae34-142">When a new line is added on the **Certificate profile settings** page, its priority is set to a number that is one more than the priority of the previous line.</span></span> <span data-ttu-id="aae34-143">Para alterar a prioridade de uma linha específica, selecione a linha e selecione **Mover para cima** para aumentar a prioridade ou **Mover para baixo** para diminuir a prioridade.</span><span class="sxs-lookup"><span data-stu-id="aae34-143">To change the priority of a specific line, select the line, and then select either **Move up** to increase the priority or **Move down** to decrease the priority.</span></span>

<span data-ttu-id="aae34-144">Ao adicionar uma nova linha à página **Configurações do perfil de certificado**, defina os seguintes campos:</span><span class="sxs-lookup"><span data-stu-id="aae34-144">When you add a new line to the **Certificate profile settings** page, set the following fields:</span></span>

- <span data-ttu-id="aae34-145">**Tipo de local** – selecione o local onde o certificado está armazenado.</span><span class="sxs-lookup"><span data-stu-id="aae34-145">**Location type** – Select the location where the certificate is stored.</span></span> <span data-ttu-id="aae34-146">Esse campo tem dois valores possíveis: **Certificado local** e **Key Vault**.</span><span class="sxs-lookup"><span data-stu-id="aae34-146">This field has two possible values: **Local certificate** and **Key Vault**.</span></span>
- <span data-ttu-id="aae34-147">**Certificado do Key Vault** – esse campo será obrigatório se você definir o campo **Tipo de local** como o **Key Vault**.</span><span class="sxs-lookup"><span data-stu-id="aae34-147">**Key Vault certificate** – This field is required if you set the **Location type** field to **Key Vault**.</span></span> <span data-ttu-id="aae34-148">Use-o para especificar um segredo de certificado do Key Vault.</span><span class="sxs-lookup"><span data-stu-id="aae34-148">Use it to specify a Key Vault certificate secret.</span></span>

    > [!NOTE]
    > <span data-ttu-id="aae34-149">Antes de usar um certificado do cofre de chaves nos perfis de certificado, certifique-se de carregar um certificado para o armazenamento do cofre de chaves e siga as instruções em [Configurar o cliente do Azure Key Vault](https://docs.microsoft.com/dynamics365/finance/localizations/setting-up-azure-key-vault-client).</span><span class="sxs-lookup"><span data-stu-id="aae34-149">Before you use a Key Vault certificate in certificate profiles, be sure to upload a certificate to the key vault storage, and follow the instructions in [Set up the Azure Key Vault client](https://docs.microsoft.com/dynamics365/finance/localizations/setting-up-azure-key-vault-client).</span></span>

- <span data-ttu-id="aae34-150">**Nome da loja** – esse campo é opcional e só estará disponível se você definir o campo **Tipo de local** como **Certificado local**.</span><span class="sxs-lookup"><span data-stu-id="aae34-150">**Store name** – This field is optional and is available only if you set the **Location type** field to **Local certificate**.</span></span> <span data-ttu-id="aae34-151">Use-o para especificar um nome de armazenamento padrão que deve ser usado para pesquisar certificados locais.</span><span class="sxs-lookup"><span data-stu-id="aae34-151">Use it to specify a default store name that should be used to search local certificates.</span></span>
- <span data-ttu-id="aae34-152">**Local da loja** – esse campo é opcional e só estará disponível se você definir o campo **Tipo de local** como **Certificado local**.</span><span class="sxs-lookup"><span data-stu-id="aae34-152">**Store location** – This field is optional and is available only if you set the **Location type** field to **Local certificate**.</span></span> <span data-ttu-id="aae34-153">Use-o para especificar um local de armazenamento padrão que deve ser usado para pesquisar certificados locais.</span><span class="sxs-lookup"><span data-stu-id="aae34-153">Use it to specify a default store location that should be used to search local certificates.</span></span>

    > [!NOTE]
    > <span data-ttu-id="aae34-154">O nome da loja e o local da loja padrão são adicionados para simplificar o processo de pesquisa de certificados locais no Commerce Runtime.</span><span class="sxs-lookup"><span data-stu-id="aae34-154">The default store name and store location are added to simplify the process of searching local certificates in the Commerce runtime.</span></span> <span data-ttu-id="aae34-155">X509StoreProvider tem uma lista de pastas em que os certificados estão armazenados.</span><span class="sxs-lookup"><span data-stu-id="aae34-155">X509StoreProvider has a list of folders where certificates are stored.</span></span> <span data-ttu-id="aae34-156">Se o nome do armazenamento padrão e o local de armazenamento padrão não forem especificados, o X509StoreProvider tentará encontrar um certificado nas outras pastas da lista.</span><span class="sxs-lookup"><span data-stu-id="aae34-156">If the default store name and the default store location aren't specified, X509StoreProvider tries to find a certificate in the other folders on its list.</span></span>

- <span data-ttu-id="aae34-157">**Impressão digital** – esse campo é obrigatório e só estará disponível se você definir o campo **Tipo de local** como **Certificado local**.</span><span class="sxs-lookup"><span data-stu-id="aae34-157">**Thumbprint** – This field is required and available only if you set the **Location type** field to **Local certificate**.</span></span> <span data-ttu-id="aae34-158">Use-o para especificar a impressão digital do certificado.</span><span class="sxs-lookup"><span data-stu-id="aae34-158">Use it to specify the certificate thumbprint.</span></span>
- <span data-ttu-id="aae34-159">**Comentários** – esse campo é opcional e permite que os usuários insiram anotações.</span><span class="sxs-lookup"><span data-stu-id="aae34-159">**Comments** – This field is optional and lets users enter notes.</span></span>

### <a name="workflow-searching-certificates-in-the-commerce-runtime"></a><span data-ttu-id="aae34-160">Fluxo de trabalho: pesquisa de certificados no Commerce Runtime</span><span class="sxs-lookup"><span data-stu-id="aae34-160">Workflow: Searching certificates in the Commerce runtime</span></span>

<span data-ttu-id="aae34-161">Este é o fluxo de trabalho básico usado para pesquisar um certificado quando um perfil de certificado é chamado no Commerce Runtime.</span><span class="sxs-lookup"><span data-stu-id="aae34-161">Here is the basic workflow that is used to search for a certificate when a certificate profile is called in the Commerce runtime.</span></span>

1. <span data-ttu-id="aae34-162">O sistema identifica se o perfil do certificado tem configurações específicas da empresa para a entidade legal atual.</span><span class="sxs-lookup"><span data-stu-id="aae34-162">The system identifies whether the certificate profile has company-specific settings for the current legal entity.</span></span>
1. <span data-ttu-id="aae34-163">O sistema tenta localizar o certificado usando os valores na página **Configurações do perfil de certificado** para a linha em que o campo **Prioridade** está definido como **1**.</span><span class="sxs-lookup"><span data-stu-id="aae34-163">The system tries to find the certificate by using the values on the **Certificate profile settings** page for the line where the **Priority** field is set to **1**.</span></span>

    - <span data-ttu-id="aae34-164">Se o campo **Tipo de local** for definido como **Key Vault**, o valor do campo **Segredo do certificado do Key Vault** será usado para procurar o certificado na página **Parâmetros do cofre de chaves**.</span><span class="sxs-lookup"><span data-stu-id="aae34-164">If the **Location type** field is set to **Key Vault**, the value of the **Key Vault certificate secret** field is used to search for the certificate on the **Key vault parameters** page.</span></span> <span data-ttu-id="aae34-165">Em seguida, o certificado é procurado no armazenamento do cofre de chaves.</span><span class="sxs-lookup"><span data-stu-id="aae34-165">The certificate is then searched for in the key vault storage.</span></span>
    - <span data-ttu-id="aae34-166">Se o campo **Tipo de local** estiver definido como **Certificado local**, o X509StoreProvider primeiro procurará o certificado usando o nome de armazenamento padrão e o local de armazenamento, se esses parâmetros forem especificados.</span><span class="sxs-lookup"><span data-stu-id="aae34-166">If the **Location type** field is set to **Local certificate**, X509StoreProvider first searches for the certificate by using the default store name and store location, if these parameters are specified.</span></span> <span data-ttu-id="aae34-167">Em seguida, ele pesquisará todas as outras pastas na lista de pastas.</span><span class="sxs-lookup"><span data-stu-id="aae34-167">It then searches in all other folders on its list of folders.</span></span>

1. <span data-ttu-id="aae34-168">Se o certificado não for encontrado, o processo será repetido para a linha em que o campo **Prioridade** está definido como **2**, e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="aae34-168">If the certificate isn't found, the process is repeated for the line where the **Priority** field is set to **2**, and so on.</span></span>

> [!NOTE]
> <span data-ttu-id="aae34-169">Se o perfil do certificado não tiver configurações para a entidade legal atual ou se a pesquisa do certificado não for bem-sucedida para todas as linhas na página **Configurações do perfil de certificado** , o certificado não será encontrado.</span><span class="sxs-lookup"><span data-stu-id="aae34-169">If the certificate profile has no settings for the current legal entity, or if the certificate search is unsuccessful for all lines on the **Certificate profile settings** page, the certificate isn't found.</span></span>

#### <a name="caching-the-results-of-certificate-searches"></a><span data-ttu-id="aae34-170">Como armazenar em cache os resultados de pesquisas de certificados</span><span class="sxs-lookup"><span data-stu-id="aae34-170">Caching the results of certificate searches</span></span>

<span data-ttu-id="aae34-171">Os resultados de pesquisas de certificados são armazenados em cache.</span><span class="sxs-lookup"><span data-stu-id="aae34-171">The results of certificate searches are cached.</span></span> <span data-ttu-id="aae34-172">O período de expiração padrão de um cache é de uma hora.</span><span class="sxs-lookup"><span data-stu-id="aae34-172">The default expiration time for a cache is one hour.</span></span> <span data-ttu-id="aae34-173">No entanto, esse tempo pode ser personalizado e pode ser definido para um valor máximo de 24 horas.</span><span class="sxs-lookup"><span data-stu-id="aae34-173">However, this time can be customized and can be set to a maximum value of 24 hours.</span></span>

### <a name="gradual-update"></a><span data-ttu-id="aae34-174">Atualização gradual</span><span class="sxs-lookup"><span data-stu-id="aae34-174">Gradual update</span></span>

<span data-ttu-id="aae34-175">Se uma nova versão do certificado for introduzida, mas não puder ser atualizada em todas as lojas ao mesmo tempo, a funcionalidade de perfis de certificado permitirá que o certificado seja atualizado gradualmente.</span><span class="sxs-lookup"><span data-stu-id="aae34-175">If a new version of the certificate is introduced, but it can't be updated in all stores at the same time, the certificate profiles functionality enables the certificate to be updated gradually.</span></span>

1. <span data-ttu-id="aae34-176">Localize um perfil de certificado e a linha que deve ser atualizada e, em seguida, selecione **Configurações**.</span><span class="sxs-lookup"><span data-stu-id="aae34-176">Find a certificate profile and the line that should be updated, and then select **Settings**.</span></span>
1. <span data-ttu-id="aae34-177">Adicione uma linha e especifique as configurações relacionadas à versão mais recente do certificado.</span><span class="sxs-lookup"><span data-stu-id="aae34-177">Add a line, and specify settings that are related to the latest version of the certificate.</span></span>
1. <span data-ttu-id="aae34-178">Aumente o valor de **Prioridade** da nova linha.</span><span class="sxs-lookup"><span data-stu-id="aae34-178">Increase the **Priority** value of the new line.</span></span> <span data-ttu-id="aae34-179">Use o botão **Mover para cima** para mover a linha de forma que ela fique acima da linha da versão anterior do mesmo certificado.</span><span class="sxs-lookup"><span data-stu-id="aae34-179">Use the **Move up** button to move the line so that it's above the line for the previous version of the same certificate.</span></span>

> [!NOTE]
> <span data-ttu-id="aae34-180">No Commerce Runtime, a nova versão do certificado será chamada primeiro.</span><span class="sxs-lookup"><span data-stu-id="aae34-180">In the Commerce runtime, the new version of the certificate will be called first.</span></span> <span data-ttu-id="aae34-181">Se o certificado ainda não tiver sido atualizado em uma loja específica ou em um terminal específico, a versão anterior será chamada.</span><span class="sxs-lookup"><span data-stu-id="aae34-181">If the certificate hasn't yet been updated in a specific store or on a specific terminal, the previous version will be called.</span></span>
