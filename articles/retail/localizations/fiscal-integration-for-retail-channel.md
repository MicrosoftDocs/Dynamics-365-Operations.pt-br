---
title: Visão geral da integração fiscal dos Canais de varejo
description: Este tópico fornece uma visão geral dos recursos de integração fiscal disponíveis no Dynamics 365 Retail.
author: josaw
manager: annbe
ms.date: 02/01/2019
ms.topic: article
ms.prod: ''
ms.service: dynamics-365-retail
ms.technology: ''
ms.search.form: RetailFunctionalityProfile, RetailFormLayout, RetailParameters
audience: Application User
ms.reviewer: josaw
ms.search.scope: Core, Operations, Retail
ms.search.region: Global
ms.search.industry: Retail
ms.author: v-kikozl
ms.search.validFrom: 2019-1-16
ms.dyn365.ops.version: 10
ms.openlocfilehash: 03853e1f80bd32c1dfe5cfcbcd77e79168f26249
ms.sourcegitcommit: 57bc7e17682e2edb5e1766496b7a22f4621819dd
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/18/2019
ms.locfileid: "2812298"
---
# <a name="overview-of-fiscal-integration-for-retail-channels"></a><span data-ttu-id="523c7-103">Visão geral da integração fiscal dos Canais de varejo</span><span class="sxs-lookup"><span data-stu-id="523c7-103">Overview of fiscal integration for Retail channels</span></span>

[!include [banner](../includes/banner.md)]

## <a name="introduction"></a><span data-ttu-id="523c7-104">Introdução</span><span class="sxs-lookup"><span data-stu-id="523c7-104">Introduction</span></span>

<span data-ttu-id="523c7-105">Este tópico é uma visão geral dos recursos de integração fiscal disponíveis no Dynamics 365 Retail.</span><span class="sxs-lookup"><span data-stu-id="523c7-105">This topic is an overview of the fiscal integration capabilities that are available in Dynamics 365 Retail.</span></span> <span data-ttu-id="523c7-106">A integração fiscal inclui a integração com vários serviços e dispositivos fiscais que permitem o registro fiscal de vendas de varejo de acordo com as leis fiscais locais, destinadas a impedir fraudes fiscais no setor de varejo.</span><span class="sxs-lookup"><span data-stu-id="523c7-106">Fiscal integration includes integration with various fiscal devices and services that enable fiscal registration of retail sales in accordance with local fiscal laws that are aimed at preventing tax fraud in the retail industry.</span></span> <span data-ttu-id="523c7-107">Estes são alguns cenários típicos que podem ser cobertos usando a integração fiscal:</span><span class="sxs-lookup"><span data-stu-id="523c7-107">Here are some typical scenarios that can be covered by using fiscal integration:</span></span>

- <span data-ttu-id="523c7-108">Registrar uma venda de varejo em um dispositivo fiscal conectado ao ponto de venda (PDV) do Retail, como uma impressora fiscal, e imprimir um recibo fiscal para o cliente.</span><span class="sxs-lookup"><span data-stu-id="523c7-108">Register a retail sale on a fiscal device that is connected to Retail point of sale (POS), such as a fiscal printer, and print a fiscal receipt for the customer.</span></span>
- <span data-ttu-id="523c7-109">Enviar com segurança informações relacionadas a vendas e devoluções concluídas no Retail POS a um serviço Web externo operado pela autoridade fiscal.</span><span class="sxs-lookup"><span data-stu-id="523c7-109">Securely submit information that is related to sales and returns that are completed in Retail POS to an external web-service that is operated by the tax authority.</span></span>
- <span data-ttu-id="523c7-110">Ajudar a garantir a inalterabilidade dos dados de transação de vendas por meio de assinaturas digitais.</span><span class="sxs-lookup"><span data-stu-id="523c7-110">Help guarantee inalterability of sales transaction data through digital signatures.</span></span>

<span data-ttu-id="523c7-111">A funcionalidade de integração fiscal é uma estrutura que fornece uma solução comum para o desenvolvimento e a personalização da integração entre o Retail POS e os serviços e dispositivos fiscais.</span><span class="sxs-lookup"><span data-stu-id="523c7-111">The fiscal integration functionality is a framework that provides a common solution for further development and customization of the integration between Retail POS and fiscal devices and services.</span></span> <span data-ttu-id="523c7-112">Ela também inclui exemplos de integração fiscal que oferecem suporte a cenários de varejo básicos para países ou regiões específicos e que funcionam com serviços ou dispositivos fiscais específicos.</span><span class="sxs-lookup"><span data-stu-id="523c7-112">The functionality also includes fiscal integration samples that support basic retail scenarios for specific countries or regions, and that work with specific fiscal devices or services.</span></span> <span data-ttu-id="523c7-113">Um exemplo de integração fiscal consiste em várias extensões de componentes do Retail e está incluído no kit de desenvolvimento de software (SDK).</span><span class="sxs-lookup"><span data-stu-id="523c7-113">A fiscal integration sample consists of several extensions of Retail components and is included in the software development kit (SDK).</span></span> <span data-ttu-id="523c7-114">Para obter mais informações sobre os exemplos de integração fiscal, consulte [Exemplos de integração fiscal no SDK do Retail](#fiscal-integration-samples-in-the-retail-sdk).</span><span class="sxs-lookup"><span data-stu-id="523c7-114">For more information about the fiscal integration samples, see [Fiscal integration samples in the Retail SDK](#fiscal-integration-samples-in-the-retail-sdk).</span></span> <span data-ttu-id="523c7-115">Para obter informações sobre como instalar e usar o SDK do Retail, consulte [Arquitetura do SDK (software development kit) do Retail](../dev-itpro/retail-sdk/retail-sdk-overview.md).</span><span class="sxs-lookup"><span data-stu-id="523c7-115">For information about how to install and use the Retail SDK, see [Retail software development kit (SDK) architecture](../dev-itpro/retail-sdk/retail-sdk-overview.md).</span></span>

<span data-ttu-id="523c7-116">Para oferecer suporte a outros cenários que não têm suporte de um exemplo de integração fiscal, integrar o Retail POS a outros serviços ou dispositivos fiscais ou cobrir requisitos de outros países ou regiões, é necessário estender um exemplo de integração fiscal existente ou criar um novo exemplo usando um existente como modelo.</span><span class="sxs-lookup"><span data-stu-id="523c7-116">To support other scenarios that aren't supported by a fiscal integration sample, to integrate Retail POS with other fiscal devices or services, or to cover requirements of other countries or regions, you must either extend an existing fiscal integration sample or create a new sample by using an existing sample as an example.</span></span>

## <a name="fiscal-registration-process-and-fiscal-integration-samples-for-fiscal-devices"></a><span data-ttu-id="523c7-117">Processo de registro fiscal e exemplos de integração fiscal para dispositivos fiscais</span><span class="sxs-lookup"><span data-stu-id="523c7-117">Fiscal registration process and fiscal integration samples for fiscal devices</span></span>

<span data-ttu-id="523c7-118">Um processo de registro fiscal no Retail POS pode consistir em uma ou mais etapas.</span><span class="sxs-lookup"><span data-stu-id="523c7-118">A fiscal registration process in Retail POS can consist of one or more steps.</span></span> <span data-ttu-id="523c7-119">Cada etapa envolve o registro fiscal de eventos ou transações de varejo específicos em um serviço ou dispositivo fiscal.</span><span class="sxs-lookup"><span data-stu-id="523c7-119">Each step involves fiscal registration of specific retail transactions or events in one fiscal device or service.</span></span> <span data-ttu-id="523c7-120">Os seguintes componentes de solução participam do registro fiscal em um dispositivo fiscal conectado a uma Estação de hardware:</span><span class="sxs-lookup"><span data-stu-id="523c7-120">The following solution components participate in the fiscal registration in a fiscal device that is connected to a Hardware station:</span></span>

- <span data-ttu-id="523c7-121">**Extensão Commerce Runtime (CRT)** – Este componente serializa dados de eventos/transações de varejo no formato que também é usado para interação com o dispositivo fiscal, analisa respostas do dispositivo fiscal e as armazena no banco de dados do canal.</span><span class="sxs-lookup"><span data-stu-id="523c7-121">**Commerce runtime (CRT) extension** – This component serializes retail transaction/event data in the format that is also used for interaction with the fiscal device, parses responses from the fiscal device, and stores the responses in the channel database.</span></span> <span data-ttu-id="523c7-122">A extensão também define as transações e os eventos específicos que devem ser registrados.</span><span class="sxs-lookup"><span data-stu-id="523c7-122">The extension also defines the specific transactions and events that must be registered.</span></span> <span data-ttu-id="523c7-123">Esse componente geralmente é conhecido como *provedor de documentos fiscais*.</span><span class="sxs-lookup"><span data-stu-id="523c7-123">This component is often referred to as a *fiscal document provider*.</span></span>
- <span data-ttu-id="523c7-124">**Extensão Estação de hardware** – Este componente inicializa a comunicação com o dispositivo fiscal, envia solicitações e comandos diretos a esse dispositivo com base nos dados de eventos/transações de varejo que são extraídos do documento fiscal e recebe respostas desse dispositivo.</span><span class="sxs-lookup"><span data-stu-id="523c7-124">**Hardware station extension** – This component initializes the communication with the fiscal device, sends requests and direct commands to the fiscal device based on the retail transaction/event data that is extracted from the fiscal document, and receives responses from the fiscal device.</span></span> <span data-ttu-id="523c7-125">Esse componente geralmente é conhecido como *conector fiscal*.</span><span class="sxs-lookup"><span data-stu-id="523c7-125">This component is often referred to as a *fiscal connector*.</span></span>

<span data-ttu-id="523c7-126">Um exemplo de integração fiscal de um dispositivo fiscal contém as extensões CRT e Estação de hardware para um provedor de documentos fiscais e um conector fiscal, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="523c7-126">A fiscal integration sample for a fiscal device contains the CRT and Hardware station extensions for a fiscal document provider and a fiscal connector, respectively.</span></span> <span data-ttu-id="523c7-127">Também contém as seguintes configurações de componentes:</span><span class="sxs-lookup"><span data-stu-id="523c7-127">It also contains the following component configurations:</span></span>

- <span data-ttu-id="523c7-128">**Configuração do provedor de documentos fiscais** – Esta configuração define um método de saída e um formato para documentos fiscais.</span><span class="sxs-lookup"><span data-stu-id="523c7-128">**Fiscal document provider configuration** – This configuration defines an output method and a format for fiscal documents.</span></span> <span data-ttu-id="523c7-129">Também contém um mapeamento de dados de impostos e métodos de pagamento para tornar os dados do Retail POS compatíveis com os valores predefinidos no firmware do dispositivo fiscal.</span><span class="sxs-lookup"><span data-stu-id="523c7-129">It also contains a data mapping for taxes and payment methods, to make data from Retail POS compatible with the values that are predefined in the fiscal device firmware.</span></span>
- <span data-ttu-id="523c7-130">**Configuração do conector fiscal** – Esta configuração define a comunicação física com o dispositivo fiscal específico.</span><span class="sxs-lookup"><span data-stu-id="523c7-130">**Fiscal connector configuration** – This configuration defines the physical communication with the specific fiscal device.</span></span>

<span data-ttu-id="523c7-131">Um processo de registro fiscal para um terminal de PDV específico é definido por uma configuração correspondente no perfil de funcionalidade do PDV.</span><span class="sxs-lookup"><span data-stu-id="523c7-131">A fiscal registration process for a specific POS register is defined by a corresponding setting in the POS functionality profile.</span></span> <span data-ttu-id="523c7-132">Para obter mais detalhes sobre como configurar um processo de registro fiscal, carregar configurações do provedor de documentos fiscais e do conector fiscal e alterar seus parâmetros, consulte [Configurar um processo de registro fiscal](setting-up-fiscal-integration-for-retail-channel.md#set-up-a-fiscal-registration-process).</span><span class="sxs-lookup"><span data-stu-id="523c7-132">For more details about how to configure a fiscal registration process, upload fiscal document provider and fiscal connector configurations, and change their parameters, see [Set up a fiscal registration process](setting-up-fiscal-integration-for-retail-channel.md#set-up-a-fiscal-registration-process).</span></span>

<span data-ttu-id="523c7-133">O exemplo a seguir mostra um típico fluxo de execução de registro fiscal para um dispositivo fiscal.</span><span class="sxs-lookup"><span data-stu-id="523c7-133">The following example shows a typical fiscal registration execution flow for a fiscal device.</span></span> <span data-ttu-id="523c7-134">O fluxo começa com um evento no PDV (por exemplo, finalização de uma transação de venda) e implementa a seguinte sequência de etapas:</span><span class="sxs-lookup"><span data-stu-id="523c7-134">The flow starts with an event in the POS (for example, finalization of a sales transaction) and implements the following sequence of steps:</span></span>

1. <span data-ttu-id="523c7-135">O PDV solicita um documento fiscal do CRT.</span><span class="sxs-lookup"><span data-stu-id="523c7-135">The POS requests a fiscal document from CRT.</span></span>
2. <span data-ttu-id="523c7-136">O CRT determina se o evento atual requer registro fiscal.</span><span class="sxs-lookup"><span data-stu-id="523c7-136">CRT determines whether the current event requires fiscal registration.</span></span>
3. <span data-ttu-id="523c7-137">Com base nas configurações do processo de registro fiscal, o CRT identifica um conector fiscal e o provedor de documentos fiscais correspondente para usar no registro fiscal.</span><span class="sxs-lookup"><span data-stu-id="523c7-137">Based on the fiscal registration process settings, CRT identifies a fiscal connector and corresponding fiscal document provider to use for the fiscal registration.</span></span>
4. <span data-ttu-id="523c7-138">O CRT executa o provedor de documentos fiscais que gera um documento fiscal (por exemplo, um documento XML) que representa o evento ou a transação de varejo.</span><span class="sxs-lookup"><span data-stu-id="523c7-138">CRT runs the fiscal document provider that generates a fiscal document (for example, an XML document) that represents the retail transaction or event.</span></span>
5. <span data-ttu-id="523c7-139">O PDV envia o documento fiscal que o CRT prepara para uma Estação de hardware.</span><span class="sxs-lookup"><span data-stu-id="523c7-139">The POS sends the fiscal document that CRT prepares to a Hardware station.</span></span>
6. <span data-ttu-id="523c7-140">A Estação de hardware executa o conector fiscal que processa o documento fiscal e o comunica ao serviço ou dispositivo fiscal.</span><span class="sxs-lookup"><span data-stu-id="523c7-140">The Hardware station runs the fiscal connector that processes the fiscal document and communicates it to the fiscal device or service.</span></span>
7. <span data-ttu-id="523c7-141">O PDV analisa a resposta do serviço ou dispositivo fiscal para determinar se o registro fiscal foi bem-sucedido.</span><span class="sxs-lookup"><span data-stu-id="523c7-141">The POS analyzes the response from the fiscal device or service to determine whether the fiscal registration was successful.</span></span>
8. <span data-ttu-id="523c7-142">O CRT salva a resposta no banco de dados do canal.</span><span class="sxs-lookup"><span data-stu-id="523c7-142">CRT saves the response to the channel database.</span></span>

<span data-ttu-id="523c7-143">![Esquema da solução](media/emea-fiscal-integration-solution.png "Esquema da solução")</span><span class="sxs-lookup"><span data-stu-id="523c7-143">![Solution schema](media/emea-fiscal-integration-solution.png "Solution schema")</span></span>

## <a name="error-handling"></a><span data-ttu-id="523c7-144">Tratamento de erros</span><span class="sxs-lookup"><span data-stu-id="523c7-144">Error handling</span></span>

<span data-ttu-id="523c7-145">A estrutura de integração fiscal fornece as seguintes opções para lidar com as falhas durante o registro fiscal:</span><span class="sxs-lookup"><span data-stu-id="523c7-145">The fiscal integration framework provides the following options to handle failures during fiscal registration:</span></span>

- <span data-ttu-id="523c7-146">**Repetir** – Os operadores podem usar esta opção quando a falha puder ser resolvida rapidamente e o registro fiscal puder ser executado novamente.</span><span class="sxs-lookup"><span data-stu-id="523c7-146">**Retry** – Operators can use this option when the failure can be resolved quickly, and the fiscal registration can be rerun.</span></span> <span data-ttu-id="523c7-147">Por exemplo, essa opção pode ser usada quando o dispositivo fiscal não estiver conectado, a impressora fiscal estiver sem papel ou houver uma obstrução de papel nessa impressora.</span><span class="sxs-lookup"><span data-stu-id="523c7-147">For example, this option can be used when the fiscal device isn't connected, the fiscal printer is out of paper, or there is a paper jam in the fiscal printer.</span></span>
- <span data-ttu-id="523c7-148">**Cancelar** – Esta opção permite aos operadores adiar o registro fiscal do evento ou da transação atual se ele falhar.</span><span class="sxs-lookup"><span data-stu-id="523c7-148">**Cancel** – This option lets operators postpone the fiscal registration of the current transaction or event if it fails.</span></span> <span data-ttu-id="523c7-149">Após o adiamento do registro, o operador pode continuar a trabalhar no PDV e concluir qualquer operação que não exija o registro fiscal.</span><span class="sxs-lookup"><span data-stu-id="523c7-149">After the registration is postponed, the operator can continue to work on the POS and can complete any operation that the fiscal registration isn't required for.</span></span> <span data-ttu-id="523c7-150">Quando qualquer evento que exija o registro fiscal ocorrer no PDV (por exemplo, uma nova transação for aberta), a caixa de diálogo de tratamento de erro aparecerá automaticamente para notificar o operador que a transação anterior não foi registrada corretamente e para fornecer as opções de tratamento de erro.</span><span class="sxs-lookup"><span data-stu-id="523c7-150">When any event that requires the fiscal registration occurs in the POS (for example, a new transaction is opened), the error handling dialog box automatically appears to notify the operator that the previous transaction wasn't correctly registered and to provide the error handling options.</span></span>
- <span data-ttu-id="523c7-151">**Ignorar** – Os operadores podem usar esta opção quando o registro fiscal puder ser omitido sob condições específicas e as operações normais puderem continuar no PDV.</span><span class="sxs-lookup"><span data-stu-id="523c7-151">**Skip** – Operators can use this option when the fiscal registration can be omitted under specific conditions and regular operations can be continued on the POS.</span></span> <span data-ttu-id="523c7-152">Por exemplo, essa opção pode ser usada quando uma transação de venda cujo registro fiscal tenha falhado puder ser registrada em um diário de papel especial.</span><span class="sxs-lookup"><span data-stu-id="523c7-152">For example, this option can be used when a sales transaction that the fiscal registration failed for can be registered in a special paper journal.</span></span>
- <span data-ttu-id="523c7-153">**Marcar como registrado** – Os operadores podem usar esta opção quando a transação for registrada no dispositivo fiscal (por exemplo, um recibo fiscal for impresso), mas uma falha ocorrer quando a resposta fiscal estiver sendo salva no banco de dados do canal.</span><span class="sxs-lookup"><span data-stu-id="523c7-153">**Mark as registered** – Operators can use this option when the transaction was actually registered in the fiscal device (for example, a fiscal receipt was printed), but a failure occurred when the fiscal response was being saved to the channel database.</span></span>

> [!NOTE]
> <span data-ttu-id="523c7-154">As opções **Ignorar** e **Marcar como registrado** devem ser ativadas no processo de registro fiscal antes de serem usadas.</span><span class="sxs-lookup"><span data-stu-id="523c7-154">The **Skip** and **Mark as registered** options must be activated in the fiscal registration process before they are used.</span></span> <span data-ttu-id="523c7-155">Além disso, permissões correspondentes devem ser concedidas aos operadores.</span><span class="sxs-lookup"><span data-stu-id="523c7-155">In addition, corresponding permissions must be granted to operators.</span></span>

<span data-ttu-id="523c7-156">As opções **Ignorar** e **Marcar como registrado** permitem que os códigos informativos capturem algumas informações específicas sobre a falha, como o motivo da falha ou uma justificativa para ignorar o registro fiscal ou marcar a transação como registrada.</span><span class="sxs-lookup"><span data-stu-id="523c7-156">The **Skip** and **Mark as registered** options enable info codes to capture some specific information about the failure, such as the reason for the failure or a justification for skipping the fiscal registration or marking the transaction as registered.</span></span> <span data-ttu-id="523c7-157">Para obter mais detalhes sobre como configurar parâmetros de tratamento de erro, consulte [Definir configurações de tratamento de erro](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).</span><span class="sxs-lookup"><span data-stu-id="523c7-157">For more details about how to set up error handling parameters, see [Set error handling settings](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).</span></span>

### <a name="optional-fiscal-registration"></a><span data-ttu-id="523c7-158">Registro fiscal opcional</span><span class="sxs-lookup"><span data-stu-id="523c7-158">Optional fiscal registration</span></span>

<span data-ttu-id="523c7-159">O registro fiscal pode ser obrigatório para algumas operações mas opcional para outras.</span><span class="sxs-lookup"><span data-stu-id="523c7-159">Fiscal registration might be mandatory for some operations but optional for others.</span></span> <span data-ttu-id="523c7-160">Por exemplo, o registro fiscal de vendas normais e de devoluções pode ser obrigatório, mas o registro fiscal de operações relacionadas a depósitos de clientes pode ser opcional.</span><span class="sxs-lookup"><span data-stu-id="523c7-160">For example, the fiscal registration of regular sales and returns might be mandatory, but the fiscal registration of operations that are related to customer deposits might be optional.</span></span> <span data-ttu-id="523c7-161">Nesse caso, a falha em concluir o registro fiscal de uma venda deve bloquear vendas futuras, mas a falha em concluir o registro fiscal de um depósito de cliente não deve bloquear vendas futuras.</span><span class="sxs-lookup"><span data-stu-id="523c7-161">In this case, failure to complete the fiscal registration of a sale should block further sales, but failure to complete the fiscal registration of a customer deposit should not block further sales.</span></span> <span data-ttu-id="523c7-162">Para diferenciar operações obrigatórias e opcionais, recomendamos tratá-las por meio de provedores de documentos diferentes, e que você configure etapas separadas no processo de registro fiscal para esses provedores.</span><span class="sxs-lookup"><span data-stu-id="523c7-162">To distinguish mandatory and optional operations, we recommend that you handle them through different document providers, and that you set up separate steps in the fiscal registration process for those providers.</span></span> <span data-ttu-id="523c7-163">O parâmetro **Continuar se houver erro** deve estar habilitado para qualquer etapa relacionada ao registro fiscal opcional.</span><span class="sxs-lookup"><span data-stu-id="523c7-163">The **Continue on error** parameter should be enabled for any step that is related to optional fiscal registration.</span></span> <span data-ttu-id="523c7-164">Para obter mais detalhes sobre como configurar parâmetros de tratamento de erro, consulte [Definir configurações de tratamento de erro](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).</span><span class="sxs-lookup"><span data-stu-id="523c7-164">For more details about how to set up error handling parameters, see [Set error handling settings](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).</span></span>

### <a name="manually-running-fiscal-registration"></a><span data-ttu-id="523c7-165">Executando o registro fiscal manualmente</span><span class="sxs-lookup"><span data-stu-id="523c7-165">Manually running fiscal registration</span></span>

<span data-ttu-id="523c7-166">Se o registro fiscal de uma transação ou de um evento foi adiado após uma falha (por exemplo, se o operador selecionou **Cancelar** na caixa de diálogo de tratamento de erro), você pode executar novamente o registro fiscal manualmente invocando uma operação correspondente.</span><span class="sxs-lookup"><span data-stu-id="523c7-166">If the fiscal registration of a transaction or event has been postponed after a failure (for example, if the operator selected **Cancel** in the error handling dialog box), you can manually rerun the fiscal registration by invoking a corresponding operation.</span></span> <span data-ttu-id="523c7-167">Para obter mais detalhes, consulte [Habilitar a execução manual do registro fiscal adiado](setting-up-fiscal-integration-for-retail-channel.md#enable-manual-execution-of-postponed-fiscal-registration).</span><span class="sxs-lookup"><span data-stu-id="523c7-167">For more details, see [Enable manual execution of postponed fiscal registration](setting-up-fiscal-integration-for-retail-channel.md#enable-manual-execution-of-postponed-fiscal-registration).</span></span>

### <a name="fiscal-registration-health-check"></a><span data-ttu-id="523c7-168">Verificação de integridade do registro fiscal</span><span class="sxs-lookup"><span data-stu-id="523c7-168">Fiscal registration health check</span></span>

<span data-ttu-id="523c7-169">O procedimento de verificação de integridade para registros fiscais verifica a disponibilidade do dispositivo fiscal ou do serviço quando ocorrem eventos específicos.</span><span class="sxs-lookup"><span data-stu-id="523c7-169">The health check procedure for fiscal registrations verifies the availability of the fiscal device or service when specific events occur.</span></span> <span data-ttu-id="523c7-170">Se o registro fiscal não puder ser concluído no momento, o operador será notificado antecipadamente.</span><span class="sxs-lookup"><span data-stu-id="523c7-170">If the fiscal registration can't currently be completed, the operator is notified in advance.</span></span>

<span data-ttu-id="523c7-171">O PDV executa a verificação de integridade quando ocorrem os seguintes eventos:</span><span class="sxs-lookup"><span data-stu-id="523c7-171">The POS runs the health check when the following events occur:</span></span>

- <span data-ttu-id="523c7-172">Uma nova transação é aberta.</span><span class="sxs-lookup"><span data-stu-id="523c7-172">A new transaction is opened.</span></span>
- <span data-ttu-id="523c7-173">Uma transação suspensa é recuperada.</span><span class="sxs-lookup"><span data-stu-id="523c7-173">A suspended transaction is recalled.</span></span>
- <span data-ttu-id="523c7-174">Uma transação de venda ou de devolução é finalizada.</span><span class="sxs-lookup"><span data-stu-id="523c7-174">A sales or return transaction is finalized.</span></span>

<span data-ttu-id="523c7-175">Se houver falha na verificação de integridade, o PDV exibirá a caixa de diálogo de verificação de integridade.</span><span class="sxs-lookup"><span data-stu-id="523c7-175">If the health check fails, the POS shows the health check dialog box.</span></span> <span data-ttu-id="523c7-176">Essa caixa de diálogo fornece os seguintes botões:</span><span class="sxs-lookup"><span data-stu-id="523c7-176">This dialog box provides the following buttons:</span></span>

- <span data-ttu-id="523c7-177">**OK** — esse botão permite que o operador ignore um erro de verificação de integridade e continue o processamento da operação.</span><span class="sxs-lookup"><span data-stu-id="523c7-177">**OK** – This button lets the operator ignore a health check error and continue to process the operation.</span></span> <span data-ttu-id="523c7-178">Os operadores só poderão selecionar esse botão se a permissão **Permitir ignorar o erro de verificação de integridade** estiver habilitada para eles.</span><span class="sxs-lookup"><span data-stu-id="523c7-178">Operators can select this button only if the **Allow skip health check error** permission is enabled for them.</span></span>
- <span data-ttu-id="523c7-179">**Cancelar** — se o operador selecionar esse botão, o PDV cancelará a última ação (por exemplo, um item não será adicionado a uma nova transação.)</span><span class="sxs-lookup"><span data-stu-id="523c7-179">**Cancel** – If the operator selects this button, the POS cancels the last action (for example, an item isn't added to a new transaction).</span></span>

> [!NOTE]
> <span data-ttu-id="523c7-180">A verificação de integridade será executada somente se a operação atual exigir o registro fiscal e se o parâmetro **Continuar se houver erro** estiver desabilitado para a etapa atual do processo de registro fiscal.</span><span class="sxs-lookup"><span data-stu-id="523c7-180">The health check is run only if the current operation requires fiscal registration, and if  the **Continue on error** parameter is disabled for the current step of the fiscal registration process.</span></span> <span data-ttu-id="523c7-181">Para obter mais detalhes, consulte [Definir configurações de tratamento de erro](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).</span><span class="sxs-lookup"><span data-stu-id="523c7-181">For more details, see [Set error handling settings](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).</span></span>

## <a name="storing-fiscal-response-in-fiscal-transaction"></a><span data-ttu-id="523c7-182">Armazenamento da resposta fiscal na transação fiscal</span><span class="sxs-lookup"><span data-stu-id="523c7-182">Storing fiscal response in fiscal transaction</span></span>

<span data-ttu-id="523c7-183">Quando o registro fiscal de um evento ou uma transação é bem-sucedido, uma transação fiscal é criada no banco de dados do canal e vinculada ao evento ou à transação original.</span><span class="sxs-lookup"><span data-stu-id="523c7-183">When fiscal registration of a transaction or event is successful, a fiscal transaction is created in the channel database and linked to the original transaction or event.</span></span> <span data-ttu-id="523c7-184">Da mesma forma, se a opção **Ignorar** ou **Marcar como registrado** for selecionada para um registro fiscal com falha, essas informações serão armazenadas em uma transação fiscal.</span><span class="sxs-lookup"><span data-stu-id="523c7-184">Similarly, if the **Skip** or **Mark as registered** option is selected for a failed fiscal registration, this information is stored in a fiscal transaction.</span></span> <span data-ttu-id="523c7-185">Uma transação fiscal armazena a resposta fiscal do serviço ou dispositivo fiscal.</span><span class="sxs-lookup"><span data-stu-id="523c7-185">A fiscal transaction holds the fiscal response of the fiscal device or service.</span></span> <span data-ttu-id="523c7-186">Se o processo de registro fiscal consistir em várias etapas, uma transação fiscal será criada para cada etapa do processo que resultou em um registro com êxito ou falha.</span><span class="sxs-lookup"><span data-stu-id="523c7-186">If the fiscal registration process consists of several steps, a fiscal transaction is created for each step of the process that resulted in a successful or failed registration.</span></span>

<span data-ttu-id="523c7-187">As transações fiscais são transferidas para o Retail Headquarters pelo *trabalho P*, juntamente com as transações de varejo.</span><span class="sxs-lookup"><span data-stu-id="523c7-187">Fiscal transactions are transferred to Retail Headquarters by the *P-job*, together with retail transactions.</span></span> <span data-ttu-id="523c7-188">Na FastTab **Transações fiscais** da página **Transações da loja de varejo**, você pode visualizar as transações fiscais vinculadas a transações de varejo.</span><span class="sxs-lookup"><span data-stu-id="523c7-188">On the **Fiscal transactions** FastTab of the **Retail store transactions** page, you can view the fiscal transactions that are linked to retail transactions.</span></span>

<span data-ttu-id="523c7-189">Uma transação fiscal armazena os seguintes detalhes:</span><span class="sxs-lookup"><span data-stu-id="523c7-189">A fiscal transaction stores the following details:</span></span>

- <span data-ttu-id="523c7-190">Detalhes do processo de registro fiscal (processo, grupo do conector, conector etc.).</span><span class="sxs-lookup"><span data-stu-id="523c7-190">Fiscal registration process details (process, connector group, connector, and so on).</span></span> <span data-ttu-id="523c7-191">Ela também armazena o número de série do dispositivo fiscal no campo **Número do registro**, se essa informação estiver incluída na resposta fiscal.</span><span class="sxs-lookup"><span data-stu-id="523c7-191">It also stores the serial number of the fiscal device in the **Register number** field, if this information is included in the fiscal response.</span></span>
- <span data-ttu-id="523c7-192">O status do registro fiscal: **Concluído** para registros bem-sucedidos, **Ignorado** se o operador tiver selecionado a opção **Ignorar** para um registro com falha ou **Marcado como registrado** se o operador tiver selecionado a opção **Marcar como registrado**.</span><span class="sxs-lookup"><span data-stu-id="523c7-192">The status of the fiscal registration: **Completed** for successful registration, **Skipped** if the operator selected the **Skip** option for a failed registration, or **Marked as registered** if the operator selected the **Mark as registered** option.</span></span>
- <span data-ttu-id="523c7-193">Transações de código informativo relacionadas a uma transação fiscal selecionada.</span><span class="sxs-lookup"><span data-stu-id="523c7-193">Info code transactions that are related to a selected fiscal transaction.</span></span> <span data-ttu-id="523c7-194">Para exibir as transações de código informativo, na FastTab **Transações fiscais**, selecione uma transação fiscal com status **Ignorado** ou **Marcado como registrado** e, em seguida, selecione **Transações de código informativo**.</span><span class="sxs-lookup"><span data-stu-id="523c7-194">To view the info code transactions, on the **Fiscal transactions** FastTab, select a fiscal transaction that has a status of **Skipped** or **Marked as registered**, and then select **Info code transactions**.</span></span>

## <a name="fiscal-texts-for-discounts"></a><span data-ttu-id="523c7-195">Textos fiscais para descontos</span><span class="sxs-lookup"><span data-stu-id="523c7-195">Fiscal texts for discounts</span></span>

<span data-ttu-id="523c7-196">Alguns países ou regiões têm requisitos especiais sobre textos adicionais que devem ser impressos em recibos fiscais quando diferentes tipos de descontos são aplicados.</span><span class="sxs-lookup"><span data-stu-id="523c7-196">Some countries or regions have special requirements about additional texts that must be printed on fiscal receipts when different kinds of discounts are applied.</span></span> <span data-ttu-id="523c7-197">A funcionalidade de integração fiscal permite configurar um texto especial para um desconto que é impresso após a linha de desconto no recibo fiscal.</span><span class="sxs-lookup"><span data-stu-id="523c7-197">The fiscal integration functionality lets you set up a special text for a discount that is printed after a discount line on a fiscal receipt.</span></span> <span data-ttu-id="523c7-198">Para descontos manuais, você pode configurar um texto fiscal para o código informativo especificado como **Desconto de produto** no perfil de funcionalidade do PDV.</span><span class="sxs-lookup"><span data-stu-id="523c7-198">For manual discounts, you can configure a fiscal text for the info code that is specified as the **Product discount** info code in the POS functionality profile.</span></span> <span data-ttu-id="523c7-199">Para obter mais detalhes sobre como configurar textos fiscais para descontos, consulte [Configurar textos fiscais para descontos](setting-up-fiscal-integration-for-retail-channel.md#set-up-fiscal-texts-for-discounts).</span><span class="sxs-lookup"><span data-stu-id="523c7-199">For more details about how to set up fiscal texts for discounts, see [Set up fiscal texts for discounts](setting-up-fiscal-integration-for-retail-channel.md#set-up-fiscal-texts-for-discounts).</span></span>

## <a name="printing-fiscal-x-and-fiscal-z-reports"></a><span data-ttu-id="523c7-200">Impressão de relatórios fiscais X e Z</span><span class="sxs-lookup"><span data-stu-id="523c7-200">Printing fiscal X and fiscal Z reports</span></span>

<span data-ttu-id="523c7-201">A funcionalidade de integração fiscal oferece suporte à geração de demonstrativos de fechamento do dia específicos ao serviço ou dispositivo fiscal integrado:</span><span class="sxs-lookup"><span data-stu-id="523c7-201">Fiscal integration functionality supports generation of end-of-day statements that are specific to the integrated fiscal device or service:</span></span>

- <span data-ttu-id="523c7-202">Novos botões que executam operações correspondentes devem ser adicionados ao layout de tela do PDV.</span><span class="sxs-lookup"><span data-stu-id="523c7-202">New buttons that run corresponding operations should be added to the POS screen layout.</span></span> <span data-ttu-id="523c7-203">Para obter mais detalhes, consulte [Configurar relatórios fiscais X/Z do PDV](setting-up-fiscal-integration-for-retail-channel.md#set-up-fiscal-xz-reports-from-the-pos).</span><span class="sxs-lookup"><span data-stu-id="523c7-203">For more details, see [Set up fiscal X/Z reports from the POS](setting-up-fiscal-integration-for-retail-channel.md#set-up-fiscal-xz-reports-from-the-pos).</span></span>
- <span data-ttu-id="523c7-204">No exemplo de integração fiscal, essas operações devem ser conciliadas com as operações correspondentes do dispositivo fiscal.</span><span class="sxs-lookup"><span data-stu-id="523c7-204">In the fiscal integration sample, these operations should be matched to the corresponding operations of the fiscal device.</span></span>

## <a name="fiscal-integration-samples-in-the-retail-sdk"></a><span data-ttu-id="523c7-205">Exemplos de integração fiscal no SDK do Retail</span><span class="sxs-lookup"><span data-stu-id="523c7-205">Fiscal integration samples in the Retail SDK</span></span>

<span data-ttu-id="523c7-206">Os seguintes exemplos de integração fiscal estão disponíveis atualmente no SDK do Retail:</span><span class="sxs-lookup"><span data-stu-id="523c7-206">The following fiscal integration samples are currently available in the Retail SDK:</span></span>

- [<span data-ttu-id="523c7-207">Exemplo de integração da impressora fiscal para a Itália</span><span class="sxs-lookup"><span data-stu-id="523c7-207">Fiscal printer integration sample for Italy</span></span>](emea-ita-fpi-sample.md)
- [<span data-ttu-id="523c7-208">Exemplo de integração da impressora fiscal para a Polônia</span><span class="sxs-lookup"><span data-stu-id="523c7-208">Fiscal printer integration sample for Poland</span></span>](emea-pol-fpi-sample.md)
- [<span data-ttu-id="523c7-209">Integração de serviços de registro fiscal para a Áustria</span><span class="sxs-lookup"><span data-stu-id="523c7-209">Fiscal registration service integration sample for Austria</span></span>](emea-aut-fi-sample.md)
- [<span data-ttu-id="523c7-210">Integração de serviços de registro fiscal para a República Tcheca</span><span class="sxs-lookup"><span data-stu-id="523c7-210">Fiscal registration service integration sample for Czech Republic</span></span>](emea-cze-fi-sample.md)

<span data-ttu-id="523c7-211">A seguinte funcionalidade de integração fiscal também está disponível no SDK do Retail, mas atualmente não aproveita a estrutura de integração fiscal.</span><span class="sxs-lookup"><span data-stu-id="523c7-211">The following fiscal integration functionality is also available in the Retail SDK but doesn't currently take advantage of the fiscal integration framework.</span></span> <span data-ttu-id="523c7-212">A migração dessa funcionalidade para a estrutura de integração fiscal está planejada para atualizações posteriores.</span><span class="sxs-lookup"><span data-stu-id="523c7-212">Migration of this functionality to the fiscal integration framework is planned for later updates.</span></span>

- [<span data-ttu-id="523c7-213">Funcionalidade de caixa registradora para a França</span><span class="sxs-lookup"><span data-stu-id="523c7-213">Cash register functionality for France</span></span>](emea-fra-cash-registers.md)
- [<span data-ttu-id="523c7-214">Funcionalidade de caixa registradora para a Noruega</span><span class="sxs-lookup"><span data-stu-id="523c7-214">Cash register functionality for Norway</span></span>](emea-nor-cash-registers.md)
- [<span data-ttu-id="523c7-215">Exemplo para integração do Retail POS com unidades de controle para a Suécia</span><span class="sxs-lookup"><span data-stu-id="523c7-215">Sample for Retail POS integration with control units for Sweden</span></span>](./retail-sdk-control-unit-sample.md)
