---
title: Certificados de NF-e
description: Este tópico fornece informações sobre certificados de NF-e para o Microsoft Dynamics 365 Finance e a solução que você deve usar para cada autoridade fiscal estadual.
author: sndray
manager: AnnBe
ms.date: 01/31/2018
ms.topic: article
ms.prod: ''
ms.service: dynamics-ax-applications
ms.technology: ''
ms.search.form: CustTable, EcoResProductDetails, LogisticsAddressSetup
audience: Application User
ms.reviewer: kfend
ms.search.region: Brazil
ms.author: sndray
ms.search.validFrom: 2016-11-30
ms.dyn365.ops.version: Version 1611
ms.openlocfilehash: b72f682ffae8b8ba5d49f7b182d044afeb375942
ms.sourcegitcommit: eaf330dbee1db96c20d5ac479f007747bea079eb
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 02/15/2021
ms.locfileid: "5215056"
---
# <a name="nf-e-certificates"></a><span data-ttu-id="bfc9f-103">Certificados de NF-e</span><span class="sxs-lookup"><span data-stu-id="bfc9f-103">NF-e certificates</span></span>

[!include [banner](../includes/banner.md)]

<span data-ttu-id="bfc9f-104">Na localização brasileira, você deve gerar uma Nota Fiscal eletrônica (NF-e) para registrar a movimentação de itens e serviços entre duas partes.</span><span class="sxs-lookup"><span data-stu-id="bfc9f-104">In the Brazilian localization, you must generate a Nota Fiscal eletrônica (NF e) to register the movement of items and services between two parties.</span></span>
<span data-ttu-id="bfc9f-105">O documento fiscal NF-e deve ser assinado e transmitido à autoridade fiscal do estado usando um certificado de cliente que é emitido por uma autoridade de certificação (CA) brasileira.</span><span class="sxs-lookup"><span data-stu-id="bfc9f-105">The NF-e fiscal document must be signed and transmitted to the state tax authority using a client certificate issued by a Brazilian certificate authority (CA).</span></span>
<span data-ttu-id="bfc9f-106">Antes de gerar uma NF-e, você deve concluir as seguintes tarefas:</span><span class="sxs-lookup"><span data-stu-id="bfc9f-106">Before you can generate an NF e, you must complete the following tasks:</span></span>
- <span data-ttu-id="bfc9f-107">Configurar serviços Web, códigos de rejeição e esquemas.</span><span class="sxs-lookup"><span data-stu-id="bfc9f-107">Set up web services, rejection codes, and schemas.</span></span>
- <span data-ttu-id="bfc9f-108">Para cada estabelecimento fiscal, configure:</span><span class="sxs-lookup"><span data-stu-id="bfc9f-108">For each fiscal establishment, set up:</span></span>

    - <span data-ttu-id="bfc9f-109">O certificado do cliente</span><span class="sxs-lookup"><span data-stu-id="bfc9f-109">The client certificate</span></span>
    - <span data-ttu-id="bfc9f-110">Um ambiente</span><span class="sxs-lookup"><span data-stu-id="bfc9f-110">An environment</span></span>
    - <span data-ttu-id="bfc9f-111">Uma versão da NF-e</span><span class="sxs-lookup"><span data-stu-id="bfc9f-111">An NF-e version</span></span>
    - <span data-ttu-id="bfc9f-112">Uma autoridade</span><span class="sxs-lookup"><span data-stu-id="bfc9f-112">An authority</span></span>
    - <span data-ttu-id="bfc9f-113">Um modelo</span><span class="sxs-lookup"><span data-stu-id="bfc9f-113">A template</span></span>
    - <span data-ttu-id="bfc9f-114">Validação de esquema</span><span class="sxs-lookup"><span data-stu-id="bfc9f-114">Schema validation</span></span>
    - <span data-ttu-id="bfc9f-115">Um modo de contingência para NF-e</span><span class="sxs-lookup"><span data-stu-id="bfc9f-115">A contingency mode for NF-e</span></span>
    
- <span data-ttu-id="bfc9f-116">Configure a impressão automática do Documento auxiliar da Nota fiscal eletrônica (DANFE), de forma que o DANFE seja impresso automaticamente após a aprovação da NF-e.</span><span class="sxs-lookup"><span data-stu-id="bfc9f-116">Set up automatic printing of the Documento auxiliar da Nota fiscal eletrônica (DANFE), so that the DANFE is automatically printed after NF-e approval.</span></span>
- <span data-ttu-id="bfc9f-117">Configure os serviços da Web relacionados a uma autoridade fiscal.</span><span class="sxs-lookup"><span data-stu-id="bfc9f-117">Set up web services that are related to a fiscal authority.</span></span>
- <span data-ttu-id="bfc9f-118">Configurar um tipo de documento fiscal para NF-e.</span><span class="sxs-lookup"><span data-stu-id="bfc9f-118">Set up a fiscal document type for NF-e.</span></span>

## <a name="set-up-certificates"></a><span data-ttu-id="bfc9f-119">Configurar certificados</span><span class="sxs-lookup"><span data-stu-id="bfc9f-119">Set up certificates</span></span>
<span data-ttu-id="bfc9f-120">O processo usado para instalar certificados varia, dependendo do estado onde a nota fiscal de NF-e é emitida.</span><span class="sxs-lookup"><span data-stu-id="bfc9f-120">The process that you use to install certificates varies, depending on the state where the NF e fiscal document is issued.</span></span> <span data-ttu-id="bfc9f-121">Use o processo de instalação de certificado correto para que o Dynamics 365 Finance possa se conectar aos serviços Web do estado.</span><span class="sxs-lookup"><span data-stu-id="bfc9f-121">Use the correct certificate installation process so that Dynamics 365 Finance can connect with the state web services.</span></span>

<span data-ttu-id="bfc9f-122">O governo brasileiro atualizou a autoridade de certificação (CA) raiz usada para emitir o certificado necessário para estabelecer uma conexão de protocolo SSL (Secure Sockets Layer) no servidor.</span><span class="sxs-lookup"><span data-stu-id="bfc9f-122">The Brazilian government updated the root certification authority (CA) that is used to issue the certificate required  to establish a Secure Sockets Layer (SSL) connection on the server side.</span></span> <span data-ttu-id="bfc9f-123">A versão atual da AC Raiz é a v5.</span><span class="sxs-lookup"><span data-stu-id="bfc9f-123">The current version of the root CA is AC Raiz v5.</span></span> <span data-ttu-id="bfc9f-124">Por padrão, a versão anterior (AC Raiz v2) é implantada no Microsoft Windows.</span><span class="sxs-lookup"><span data-stu-id="bfc9f-124">By default, the previous version (AC Raiz v2) is deployed on Microsoft Windows.</span></span>

## <a name="solutions"></a><span data-ttu-id="bfc9f-125">Soluções</span><span class="sxs-lookup"><span data-stu-id="bfc9f-125">Solutions</span></span>
- <span data-ttu-id="bfc9f-126">Instalar manualmente a AC Raiz v5 – o certificado raiz deve ser instalado na loja Autoridades de certificação raiz confiáveis.</span><span class="sxs-lookup"><span data-stu-id="bfc9f-126">Manually install root CA v5 (AC Raiz v5) – The root certificate must be installed in Trusted Root Certification Authorities store.</span></span> <span data-ttu-id="bfc9f-127">Embora o governo brasileiro tenha criado um novo certificado raiz (v5), a Segurança do Windows ainda não adicionou esse certificado à loja Autoridades de certificação raiz confiáveis.</span><span class="sxs-lookup"><span data-stu-id="bfc9f-127">Although the Brazilian government created a new root certificate (v5), Windows Security hasn’t yet added this certificate to the Trusted Root Certification Authorities store.</span></span> <span data-ttu-id="bfc9f-128">Isso significa que você deverá abrir um incidente no Suporte do Windows e, em seguida, instalar manualmente o certificado.</span><span class="sxs-lookup"><span data-stu-id="bfc9f-128">This means you must open an incident in Windows Support and then manually install the certificate.</span></span> <span data-ttu-id="bfc9f-129">Você pode usar essa solução alternativa até que o grupo de Segurança do Windows chegue a um acordo com o governo brasileiro.</span><span class="sxs-lookup"><span data-stu-id="bfc9f-129">You can use this workaround until the Windows Security group reaches an agreement with the Brazilian government.</span></span>
- <span data-ttu-id="bfc9f-130">Instalar o proxy de NF-e em uma VM local – as autoridades fiscais dos estados do Ceará (CE), de Goiás (GO) e de Pernambuco (PE) não habilitaram o protocolo mais seguro e padrão de mercado, Transport Layer Security (TLS) 1.2, em seus servidores Web.</span><span class="sxs-lookup"><span data-stu-id="bfc9f-130">Install the NF-e proxy on an on-premises VM – The tax authorities for the states of Ceará (CE), Goias (GO), and Pernambuco (PE) didn’t enable the most secure and market-standard protocol, Transport Layer Security (TLS) 1.2, in their web servers.</span></span> <span data-ttu-id="bfc9f-131">No entanto, as máquinas virtuais (VMs) do Windows usadas para executar o Finance seguem a política de segurança da Microsoft e permitem apenas conexões que usam TLS 1.2.</span><span class="sxs-lookup"><span data-stu-id="bfc9f-131">However, the Windows virtual machines (VMs) that are used to run Finance follow Microsoft security policy and allow only connections that use TLS 1.2.</span></span> <span data-ttu-id="bfc9f-132">Portanto, o sistema não pode conectar-se diretamente a esses serviços Web.</span><span class="sxs-lookup"><span data-stu-id="bfc9f-132">Therefore, the system can’t connect directly to these web services.</span></span> <span data-ttu-id="bfc9f-133">Para expedir comunicações a esses três estados, os clientes devem instalar um serviço Web de proxy em uma VM do Windows local em sua assinatura do Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="bfc9f-133">To route communications to those three states, customers must install a proxy web service on an on-premises Windows VM in their Microsoft Azure subscription.</span></span>

<span data-ttu-id="bfc9f-134">Certificados brasileiros devem ser instalados por meio do Azure Key Vault.</span><span class="sxs-lookup"><span data-stu-id="bfc9f-134">Brazilian certificates must be installed via Azure Key Vault.</span></span> <span data-ttu-id="bfc9f-135">O Key Vault permite armazenar chaves de criptografia, certificados e segredos (como chaves de autenticação, chaves da conta de armazenamento, chaves de criptografia de dados, arquivos .pxf e senhas) usando chaves protegidas por módulos de segurança de hardware (HSMs).</span><span class="sxs-lookup"><span data-stu-id="bfc9f-135">Key Vault lets you store encrypt keys, certificates, and secrets (such as authentication keys, storage account keys, data encryption keys, .pxf files, and passwords) by using keys that are protected by hardware security modules (HSMs).</span></span>

<span data-ttu-id="bfc9f-136">Para obter mais informações sobre como usar chaves e segredos com o Key Vault, consulte [Sobre chaves, segredos e certificados](https://docs.microsoft.com/rest/api/keyvault/about-keys--secrets-and-certificates).</span><span class="sxs-lookup"><span data-stu-id="bfc9f-136">For more information about how to use keys and secrets with Key Vault, see [About keys, secrets, and certificates](https://docs.microsoft.com/rest/api/keyvault/about-keys--secrets-and-certificates).</span></span>
<span data-ttu-id="bfc9f-137">A tabela a seguir lista todas as autoridades fiscais e as soluções que você deve usar para instalar certificados para elas.</span><span class="sxs-lookup"><span data-stu-id="bfc9f-137">The following table lists each tax authority and the solution that you should use to install certificates for it.</span></span>

|<span data-ttu-id="bfc9f-138">Autoridade fiscal</span><span class="sxs-lookup"><span data-stu-id="bfc9f-138">Tax authority</span></span>| <span data-ttu-id="bfc9f-139">Estados</span><span class="sxs-lookup"><span data-stu-id="bfc9f-139">States</span></span>| <span data-ttu-id="bfc9f-140">Solução</span><span class="sxs-lookup"><span data-stu-id="bfc9f-140">Solution</span></span>|
|-------------|-------|---------|
|<span data-ttu-id="bfc9f-141">Sefaz Amazonas (AM)</span><span class="sxs-lookup"><span data-stu-id="bfc9f-141">Sefaz Amazonas - (AM)</span></span>| <span data-ttu-id="bfc9f-142">AM</span><span class="sxs-lookup"><span data-stu-id="bfc9f-142">AM</span></span>| <span data-ttu-id="bfc9f-143">Instalar manualmente a AC Raiz v5.</span><span class="sxs-lookup"><span data-stu-id="bfc9f-143">Manually install root CA v5.</span></span>|
|<span data-ttu-id="bfc9f-144">Sefaz Bahia (BA)</span><span class="sxs-lookup"><span data-stu-id="bfc9f-144">Sefaz Bahia (BA)</span></span>|  <span data-ttu-id="bfc9f-145">BA</span><span class="sxs-lookup"><span data-stu-id="bfc9f-145">BA</span></span>| <span data-ttu-id="bfc9f-146">Instalar manualmente a AC Raiz v5.</span><span class="sxs-lookup"><span data-stu-id="bfc9f-146">Manually install root CA v5.</span></span>|
|<span data-ttu-id="bfc9f-147">Sefaz Ceará (CE)</span><span class="sxs-lookup"><span data-stu-id="bfc9f-147">Sefaz Ceará (CE)</span></span>|  <span data-ttu-id="bfc9f-148">CE</span><span class="sxs-lookup"><span data-stu-id="bfc9f-148">CE</span></span>| <span data-ttu-id="bfc9f-149">Instalar o proxy de NF-e em uma VM local.</span><span class="sxs-lookup"><span data-stu-id="bfc9f-149">Install the NF e proxy on an on-premises VM.</span></span>|
|<span data-ttu-id="bfc9f-150">Sefaz Goiás (GO)</span><span class="sxs-lookup"><span data-stu-id="bfc9f-150">Sefaz Goias (GO)</span></span>|  <span data-ttu-id="bfc9f-151">GO</span><span class="sxs-lookup"><span data-stu-id="bfc9f-151">GO</span></span>| <span data-ttu-id="bfc9f-152">Instalar o proxy de NF-e em uma VM local.</span><span class="sxs-lookup"><span data-stu-id="bfc9f-152">Install the NF e proxy on an on-premises VM.</span></span>|
|<span data-ttu-id="bfc9f-153">Sefaz Minas Gerais (MG)</span><span class="sxs-lookup"><span data-stu-id="bfc9f-153">Sefaz Minas Gerais (MG)</span></span>|   <span data-ttu-id="bfc9f-154">MG</span><span class="sxs-lookup"><span data-stu-id="bfc9f-154">MG</span></span>| <span data-ttu-id="bfc9f-155">Instalar manualmente a AC Raiz v5.</span><span class="sxs-lookup"><span data-stu-id="bfc9f-155">Manually install root CA v5.</span></span>|
|<span data-ttu-id="bfc9f-156">Sefaz Mato Grosso do Sul (MS)</span><span class="sxs-lookup"><span data-stu-id="bfc9f-156">Sefaz Mato Grosso do Sul (MS)</span></span>| <span data-ttu-id="bfc9f-157">MS</span><span class="sxs-lookup"><span data-stu-id="bfc9f-157">MS</span></span>| <span data-ttu-id="bfc9f-158">Nenhuma solução adicional é necessária</span><span class="sxs-lookup"><span data-stu-id="bfc9f-158">No additional solution is required</span></span>|
|<span data-ttu-id="bfc9f-159">Sefaz Mato Grosso (MT)</span><span class="sxs-lookup"><span data-stu-id="bfc9f-159">Sefaz Mato Grosso (MT)</span></span>|    <span data-ttu-id="bfc9f-160">MT</span><span class="sxs-lookup"><span data-stu-id="bfc9f-160">MT</span></span>| <span data-ttu-id="bfc9f-161">Nenhuma solução adicional é necessária</span><span class="sxs-lookup"><span data-stu-id="bfc9f-161">No additional solution is required</span></span>|
|<span data-ttu-id="bfc9f-162">Sefaz Pernambuco (PE)</span><span class="sxs-lookup"><span data-stu-id="bfc9f-162">Sefaz Pernambuco (PE)</span></span>| <span data-ttu-id="bfc9f-163">PE</span><span class="sxs-lookup"><span data-stu-id="bfc9f-163">PE</span></span>| <span data-ttu-id="bfc9f-164">Instalar o proxy de NF-e em uma VM local.</span><span class="sxs-lookup"><span data-stu-id="bfc9f-164">Install the NF e proxy on an on-premises VM.</span></span>|
|<span data-ttu-id="bfc9f-165">Sefaz Paraná (PR)</span><span class="sxs-lookup"><span data-stu-id="bfc9f-165">Sefaz Paraná (PR)</span></span>| <span data-ttu-id="bfc9f-166">PR</span><span class="sxs-lookup"><span data-stu-id="bfc9f-166">PR</span></span>| <span data-ttu-id="bfc9f-167">Instalar manualmente a AC Raiz v5.</span><span class="sxs-lookup"><span data-stu-id="bfc9f-167">Manually install root CA v5.</span></span>|
|<span data-ttu-id="bfc9f-168">Sefaz Rio Grande do Sul (RS)</span><span class="sxs-lookup"><span data-stu-id="bfc9f-168">Sefaz Rio Grande do Sul (RS)</span></span>|  <span data-ttu-id="bfc9f-169">RS</span><span class="sxs-lookup"><span data-stu-id="bfc9f-169">RS</span></span>| <span data-ttu-id="bfc9f-170">Nenhuma solução adicional é necessária</span><span class="sxs-lookup"><span data-stu-id="bfc9f-170">No additional solution is required</span></span>|
|<span data-ttu-id="bfc9f-171">Sefaz São Paulo (SP)</span><span class="sxs-lookup"><span data-stu-id="bfc9f-171">Sefaz São Paulo (SP)</span></span>|  <span data-ttu-id="bfc9f-172">SP</span><span class="sxs-lookup"><span data-stu-id="bfc9f-172">SP</span></span>| <span data-ttu-id="bfc9f-173">Nenhuma solução adicional é necessária</span><span class="sxs-lookup"><span data-stu-id="bfc9f-173">No additional solution is required</span></span>|
|<span data-ttu-id="bfc9f-174">Sefaz Virtual Ambiente Nacional (SVAN)</span><span class="sxs-lookup"><span data-stu-id="bfc9f-174">Sefaz Virtual Ambiente Nacional (SVAN)</span></span>|    <span data-ttu-id="bfc9f-175">MA, PA</span><span class="sxs-lookup"><span data-stu-id="bfc9f-175">MA, PA</span></span>| <span data-ttu-id="bfc9f-176">Nenhuma solução adicional é necessária</span><span class="sxs-lookup"><span data-stu-id="bfc9f-176">No additional solution is required</span></span>|
|<span data-ttu-id="bfc9f-177">Sefaz Virtual Rio Grande do Sul (SVRS)</span><span class="sxs-lookup"><span data-stu-id="bfc9f-177">Sefaz Virtual Rio Grande do Sul (SVRS)</span></span>|    <span data-ttu-id="bfc9f-178">AC, AL, AP, DF, ES, PB, PI, RJ, RN, RO, RR, SC, SE, TO</span><span class="sxs-lookup"><span data-stu-id="bfc9f-178">AC, AL, AP, DF, ES, PB, PI, RJ, RN, RO, RR, SC, SE, TO</span></span>| <span data-ttu-id="bfc9f-179">Nenhuma solução adicional é necessária</span><span class="sxs-lookup"><span data-stu-id="bfc9f-179">No additional solution is required</span></span>|

### <a name="contingency-authorization-authorities-used-when-the-authority-is-down-or-offline"></a><span data-ttu-id="bfc9f-180">Autoridades de autorização de contingência (usadas quando a autoridade estiver fora do ar ou offline)</span><span class="sxs-lookup"><span data-stu-id="bfc9f-180">Contingency authorization authorities (used when the authority is down or offline)</span></span>

|<span data-ttu-id="bfc9f-181">Autoridade fiscal</span><span class="sxs-lookup"><span data-stu-id="bfc9f-181">Tax authority</span></span>| <span data-ttu-id="bfc9f-182">Estados</span><span class="sxs-lookup"><span data-stu-id="bfc9f-182">States</span></span>| <span data-ttu-id="bfc9f-183">Solução</span><span class="sxs-lookup"><span data-stu-id="bfc9f-183">Solution</span></span>|
|-------------|-------|---------|
|<span data-ttu-id="bfc9f-184">Sefaz Virtual de Contingência Ambiente Nacional (SVC-AN)</span><span class="sxs-lookup"><span data-stu-id="bfc9f-184">Sefaz Virtual de Contingência Ambiente Nacional (SVC-AN)</span></span>|  <span data-ttu-id="bfc9f-185">AC, AL, AP, DF, ES, MG, PB, RJ, RN, RO, RR, RS, SC, SE, SP, TO</span><span class="sxs-lookup"><span data-stu-id="bfc9f-185">AC, AL, AP, DF, ES, MG, PB, RJ, RN, RO, RR, RS, SC, SE, SP, TO</span></span>| <span data-ttu-id="bfc9f-186">Instalar manualmente a AC Raiz v5.</span><span class="sxs-lookup"><span data-stu-id="bfc9f-186">Manually install root CA v5.</span></span>|
<span data-ttu-id="bfc9f-187">Sefaz Virtual de Contingência Rio Grande do Sul (SVC-RS)</span><span class="sxs-lookup"><span data-stu-id="bfc9f-187">Sefaz Virtual de Contingência Rio Grande do Sul (SVC-RS)</span></span>|   <span data-ttu-id="bfc9f-188">AM, BA, CE, GO, MA, MS, MT, PA, PE, PI, PR</span><span class="sxs-lookup"><span data-stu-id="bfc9f-188">AM, BA, CE, GO, MA, MS, MT, PA, PE, PI, PR</span></span>| <span data-ttu-id="bfc9f-189">Nenhuma solução adicional é necessária</span><span class="sxs-lookup"><span data-stu-id="bfc9f-189">No additional solution is required</span></span>|




[!INCLUDE[footer-include](../../includes/footer-banner.md)]